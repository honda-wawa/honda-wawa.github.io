<script>
  const translations = {
    en: {{ site.data.translations.en | jsonify }},
    pl: {{ site.data.translations.pl | jsonify }}
  }

  function getLanguage() {
    const stored = localStorage.getItem('preferred-language')
    if (stored) return stored
    
    const browserLang = navigator.language || navigator.userLanguage
    return browserLang.startsWith('pl') ? 'pl' : 'en'
  }

  function setLanguage(lang) {
    localStorage.setItem('preferred-language', lang)
    applyLanguage(lang)
  }

  function applyLanguage(lang) {
    const t = translations[lang] || translations.en
    
    document.querySelectorAll('[data-translate]').forEach(el => {
      const key = el.getAttribute('data-translate')
      if (t[key]) {
        el.textContent = t[key]
      }
    })

    document.querySelectorAll('[data-translate-title]').forEach(el => {
      const key = el.getAttribute('data-translate-title')
      if (t[key]) {
        el.title = t[key]
      }
    })

    document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
      const key = el.getAttribute('data-translate-placeholder')
      if (t[key]) {
        el.placeholder = t[key]
      }
    })

    document.querySelectorAll('#lang-pl, #lang-en').forEach(btn => {
      btn.classList.remove('active')
    })
    document.getElementById('lang-' + lang).classList.add('active')

    document.documentElement.lang = lang
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      const lang = getLanguage()
      applyLanguage(lang)
    })
  } else {
    const lang = getLanguage()
    applyLanguage(lang)
  }
</script>

